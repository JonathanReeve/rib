<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Typed Routes - Rib</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" rel="icon" /><meta content="Rib includes an optional route system based on GADTs than can be used to define safe and structured routes for your site. The sample repo used in tutorial already uses routes, and you can see the entire code in preview to see all of this would fit together in a static site generator." name="description" /><link href="https://rib.srid.ca/typed-routes" rel="canonical" /><meta content="Typed Routes" property="og:title" /><meta content="Rib" property="og:site_name" /><meta content="article" property="og:type" /><script type="application/ld+json">[{"@context":"https://schema.org","itemListElement":[{"name":"Rib","item":"https://rib.srid.ca","@type":"ListItem","position":1},{"name":"Guide","item":"https://rib.srid.ca/guide","@type":"ListItem","position":2}],"@type":"BreadcrumbList"}]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(33,186,69,0.1)}body nav.bottomPane{background-color:rgba(33,186,69,2.0e-2)}body div#footnotes{border-top-color:#21ba45}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#21ba45;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(33,186,69,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script><!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><nav class="flipped tree deemphasized" id="zettel-uptree" style="transform-origin: 50%"><ul class="root"><li><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link"><a href="guide">Guide</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link"><a href=".">Rib</a></span></span></div></li></ul></li></ul></li></ul></nav><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Typed Routes</h1><p>Rib includes an optional route system based on <a href="https://ghc.gitlab.haskell.org/ghc/doc/users_guide/exts/gadt.html">GADT</a>s than can be used to define safe and structured routes for your site. The sample repo used in <span class="zettel-link-container cf"><span class="zettel-link"><a href="tutorial">Tutorial</a></span></span> already uses routes, and you can see the entire code in <span class="zettel-link-container cf"><span class="zettel-link"><a href="preview">Quick Preview</a></span></span> to see all of this would fit together in a static site generator.</p><h2 id="definining-routes">Definining Routes</h2><p>To define a route, create a GADT type called <code>Route</code> with a type parameter <code>a</code>:</p><pre><code class="haskell language-haskell">data Route a where
  Route_Home :: Route ()
  Route_Article :: FilePath -&gt; Route Pandoc</code></pre><p>Why use GADTs instead of regular ADTs? There are two reasons:</p><ol><li><p>GADTs provides us with a mechanism to specify an unique type (the type parameter <code>a</code>) for <em>each</em> of its constructor. This type, <code>a</code>, is generally the type of the value used to <em>generate</em> the static content (typically HTML) of that route.</p></li><li><p>The value used to generate a route is not necessary to create the route</p></li></ol><p>For example, this is how we create the article route (typically inside the <a href="http://hackage.haskell.org/package/rib-0.8.0.0/docs/Rib-Shake.html#v:forEvery"><code>forEvery</code></a> block):</p><pre><code class="haskell language-haskell">let r = Route_Article &quot;hello.md&quot;</code></pre><p>Note that we are able to create a route without the value used to generate it, i.e., the Markdown content (point 2). This route is of type <code>Route Pandoc</code>, which means <code>a ~ Pandoc</code>. Therefore, wherever we pass this route - when we pass the value associated with it, it must be of the type <code>Pandoc</code> (point 1). The <code>renderPage</code> function which renders the HTML of a route is defined to take both the route and its value as an argument:</p><pre><code class="haskell language-haskell">renderPage :: Route a -&gt; a -&gt; Html ()
...</code></pre><p>The <code>renderPage</code> function is thus polymorphic in the route it handles. It can render a common HTML layout, and <code>case</code> on the route value passed to render content to specific to routes. The author finds this way of rendering HTML to be much more ergonomic and pleasant compared to the various templating systems of other static site generators.</p><h2 id="customizing-route-paths">Customizing route paths</h2><p>Once your route type is defined, you may specify the file paths for each of them. To do this, simply derive an instance for the <code>IsRoute</code> class:</p><pre><code class="haskell language-haskell">instance IsRoute Route where
  routeFile = \case
    Route_Home -&gt;
      pure &quot;index.html&quot;
    Route_Article srcPath -&gt;
      pure $ &quot;article&quot; &lt;/&gt; srcPath -&lt;.&gt; &quot;.html&quot;</code></pre><p>Notice how in order to calculate the file path of a route, you only need the route (<code>Route a</code>), but not the data (<code>a</code>) used to generate it.</p><p>The arguments your route constructors take are meant to be used in the calculation of this file path. For example, the <code>FilePath</code> argument of the <code>Route_Article</code> constructor specifies the source path of the Markdown document, from which we compute the target (generated) path by simply replacing the extension with “.html” (in addition to putting it in a sub directory “article”).</p><h2 id="generating-a-route">Generating a route</h2><p><code>Rib.Route.writeRoute</code> takes a route, a string and writes that string to the file path associated with the route. You will use this in your Shake <code>Action</code> monad, typically inside a <code>forEvery</code> block.</p><h2 id="route-urls">Route URLs</h2><p>Once routes are fully defined as above, it becomes very straightforward to use them when linking in your HTML. The <code>Rib.routeUrl</code> function takes a route (<code>Route a</code>) and returns the URL to that route.</p><p>You will pass your routes to whichever function (<code>renderPage</code> is principle among them) that needs to know the URL to your generated files, as long as they remain polymorphic in the route type.</p><h2 id="see-also">See also</h2><ul><li><a href="https://old.reddit.com/r/haskell/comments/fsgqd6/monthly_hask_anything_april_2020/fm6esky/?context=3">obelisk-route</a>: the library that inspired <code>Rib.Route</code>.</li></ul></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header"><span title="Backlinks from folgezettel parents">Uplinks</span></h3><ul class="backlinks"><li><span class="zettel-link-container folge"><span class="zettel-link"><a href="guide">Guide</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"></ul></li></ul></nav><nav class="ui attached segment deemphasized bottomPane" id="neuron-tags-pane"><div><span class="ui basic label zettel-tag" title="Tag">guide</span></div></nav><nav class="ui bottom attached icon compact inverted menu green" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="item" href="https://github.com/srid/rib/edit/master/guide/./typed-routes.md" title="Edit this page"><i class="edit icon"></i></a><a class="right item" href="impulse" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.27.2" /></a></div></div></div></body></html>